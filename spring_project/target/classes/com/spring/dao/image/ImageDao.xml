<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.dao.image.ImageDao">
	<!-- result Map  메인페이지 필요 값 -->
	<resultMap type="ImageVO" id="ImageMap">
			<id			property="image_code"			column="image_code"/>
			<result 	property="image_code" 			column="image_code" />
			<result 	property="image_target" 			column="image_target" />		
			<result 	property="image_title" 			column="image_title" />
			<result 	property="image_product_code" 	column="image_product_code" />
			<collection property="image_main_list" resultMap="productMap"></collection>
		</resultMap>
	
	<resultMap type="ProductVO" id="productMap">
		<result property="product_code" 	column="product_code" />
		<result property="product_brand" 	column="product_brand" />
		<result property="product_name" 	column="product_name" />
		<result property="product_number" 	column="product_number" />
		<result property="product_price" 	column="product_price" />
		<result property="product_date" 	column="product_date" />
		<result property="product_title" 	column="product_title" />
		<result property="product_creation_date" 	column="product_creation_date" />
		<result property="product_category_code" 	column="product_category_code" />
	</resultMap>
	
	<select id="image_main_list" resultMap="ImageMap">
    SELECT i.image_code, i.image_target, i.image_title, i.image_product_code,
           p.product_brand, p.product_name, p.product_number, p.product_price
    FROM image AS i
    LEFT OUTER JOIN product AS p ON i.image_product_code = p.product_code
</select>

	<!--  -->
	
	<select id="image_search_list" resultMap="ImageMap">
    SELECT i.image_code, i.image_target, i.image_title, i.image_product_code,
       p.product_brand, p.product_name, p.product_number, p.product_price
	FROM image AS i
	LEFT OUTER JOIN product AS p ON i.image_product_code = p.product_code
	WHERE i.image_title LIKE CONCAT('%', #{search}, '%')
      OR p.product_brand LIKE CONCAT('%', #{search}, '%')
      OR p.product_name LIKE CONCAT('%', #{search}, '%')
      OR p.product_number LIKE CONCAT('%', #{search}, '%')
</select>
<!-- 마무리 해야됨 -->
<!-- 마무리 해야됨 -->
<!-- 마무리 해야됨 -->
	<select id="image_category_list" resultMap="ImageMap">
  SELECT i.image_code, i.image_target, i.image_title, i.image_product_code,
         p.product_brand, p.product_name, p.product_number, p.product_price
  FROM image AS i
  LEFT OUTER JOIN product AS p ON i.image_product_code = p.product_code
  WHERE
    <choose>
      <when test="categoryCode == '100'">
        p.product_category_code LIKE '1%'
      </when>
      <when test="categoryCode == '101'">
        p.product_category_code = '101'
      </when>
      <when test="categoryCode == '102'">
        p.product_category_code = '102'
      </when>
      <when test="categoryCode == '103'">
        p.product_category_code = '103'
      </when>
      <!-- Add more conditions as needed -->
      <otherwise>
        p.product_category_code LIKE '1%'
      </otherwise>
    </choose>
    <choose>
      <when test="orderBy == 'date'">
        ORDER BY p.product_date ASC
      </when>
      <when test="orderBy == 'high'">
        ORDER BY p.product_price DESC
      </when>
      <when test="orderBy == 'low'">
        ORDER BY p.product_price ASC
      </when>
    </choose>
</select>
	
	<select id="image_readAll"  resultType="ImageVO" >
		select * from image
	</select>

	<select id="image_count"  resultType="Integer" >
		select count(image_product_code) from image where image_product_code = #{image_product_code} 
	</select>
	
	<select id="image_read"  resultType="ImageVO" >
		select * from image where image_product_code = #{image_product_code}
	</select>
	<insert id="image_insert">
		insert into image (image_target, image_title, image_product_code)
		values ( #{image_target} , #{image_title}, #{image_product_code} )
	</insert>
	<update id="image_update">
		update image set image_target=#{image_target}, image_title=#{image_title}
		where image_product_code=#{image_product_code}    
	</update>
	
	<delete  id="image_delete">
		delete  from image where image_product_code=#{image_product_code} 
	</delete>
	
</mapper>
<!-- 


List(전체) - 미구현 
SELECT i.image_code, i.image_target, p.product_brand, p.product_name, p.product_price
FROM image AS i
LEFT JOIN product AS p ON i.image_product_code = p.product_code

C
insert into image(image_target, image_title, image_product_code) 
values(#{image_target}, #{image_title}, #{image_product_code});
										 
R
select * from image where image_product_code=#{product_code}
												#####{product_code} 주의
U
update image set image_target=#{image_target}, imgae_title=#{imgae_title}
where image_code=#{image_code} 
D 
delete from imgae where image_code=#{image_code}  

 -->